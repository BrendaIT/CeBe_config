[gcode_macro BRUSH_NOZZLE]
gcode:
  SAVE_GCODE_STATE NAME=BRUSH_NOZZLE_state
  SET_VELOCITY_LIMIT ACCEL=4000
  SET_VELOCITY_LIMIT ACCEL_TO_DECEL=2000
  G90 
  G0 X75 Y255 F20000
  G0 Z2 F3000
  G0 X10 F10000
  G0 X80 F10000
  G0 X48 F10000
  G0 Z0 F3000
  G0 Y245 F10000
  G0 Y255 F10000
  G0 Y245 F10000
  G0 Y255 F10000
  G0 Z2 F3000
  G0 X10 F10000
  G0 X80 F10000
  G0 X10 F10000
  G0 Z10 F3000
  RESTORE_GCODE_STATE NAME=BRUSH_NOZZLE_state

[gcode_macro PURGE]
gcode:
  {% set EXTRUDER = params.EXTRUDER|default(220)|int %}
  {% set PURGE = params.PURGE|default(20)|int %}
  SAVE_GCODE_STATE NAME=PURGE_state
  SET_VELOCITY_LIMIT ACCEL=4000
  SET_VELOCITY_LIMIT ACCEL_TO_DECEL=2000
  M109 S{EXTRUDER}
  G90
  G0 X85 Y255 F20000
  G0 Z2 F3000
  G91 ;relative movement
  G1 E{PURGE} F300 
  G1 E-3.0 F3600 
  RESTORE_GCODE_STATE NAME=PURGE_state

[gcode_macro PURGE_N_BRUSH]
gcode:
  {% set EXTRUDER = params.EXTRUDER|default(220)|int %}
  {% set PURGE = params.PURGE|default(20)|int %}
  PURGE EXTRUDER={EXTRUDER} PURGE={PURGE}
  BRUSH_NOZZLE
[gcode_macro BRUSH_NOZZLE]
gcode:
  SAVE_GCODE_STATE NAME=BRUSH_NOZZLE_state
  SET_VELOCITY_LIMIT ACCEL=4000
  DETACH_PROBE_UNLOCK
  {% set BRUSH_CENTER = 197 %}
  {% set BRUSH_WIDTH = 45 %}
  {% set BRUSH_SPEED = 10000 %}

  G90 
  G0 X{BRUSH_CENTER - 0.5 * BRUSH_WIDTH} Y255 F20000
  G0 Z2 F3000
  G0 X{BRUSH_CENTER + 0.5 * BRUSH_WIDTH} F{BRUSH_SPEED}
  G0 X{BRUSH_CENTER - 0.5 * BRUSH_WIDTH} F{BRUSH_SPEED}
  G0 X{BRUSH_CENTER} F{BRUSH_SPEED}
  G0 Z0.4 F3000
  G0 Y246 F{BRUSH_SPEED}
  G0 Y255 F{BRUSH_SPEED}
  G0 Y246 F{BRUSH_SPEED}
  G0 Y255 F{BRUSH_SPEED}
  G0 Z2 F3000
  G0 X{BRUSH_CENTER + 0.5 * BRUSH_WIDTH} F{BRUSH_SPEED}
  G0 X{BRUSH_CENTER - 0.5 * BRUSH_WIDTH} F{BRUSH_SPEED}
  G0 X{BRUSH_CENTER + 0.5 * BRUSH_WIDTH} F{BRUSH_SPEED}
  G0 X{BRUSH_CENTER - 0.5 * BRUSH_WIDTH} F{BRUSH_SPEED}
  G0 Z10 F3000
  RESTORE_GCODE_STATE NAME=BRUSH_NOZZLE_state

[gcode_macro PURGE]
gcode:
  {% set EXTRUDER = params.EXTRUDER|default(250)|int %}
  {% set PURGE = params.PURGE|default(20)|int %}
  SAVE_GCODE_STATE NAME=PURGE_state
  SET_VELOCITY_LIMIT ACCEL=4000
  {% set PURGE_POS = 167 %}
  M109 S{EXTRUDER}
  G90
  G0 X{PURGE_POS} Y255 F20000
  G0 Z2 F3000
  G91 ;relative movement
  G1 E{PURGE} F300 
  G1 E-3.0 F3600 
  RESTORE_GCODE_STATE NAME=PURGE_state

[gcode_macro PURGE_N_BRUSH]
gcode:
  {% set EXTRUDER = params.EXTRUDER|default(250)|int %}
  {% set PURGE = params.PURGE|default(20)|int %}
  PURGE EXTRUDER={EXTRUDER} PURGE={PURGE}
  BRUSH_NOZZLE